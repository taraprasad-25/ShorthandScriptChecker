<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dictation Error Highlighter (LCS)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }
    h1, h3 {
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 180px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .btn {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    #results {
      background-color: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    .highlight-box {
      margin-top: 20px;
      padding: 10px;
      background: #fdfdfd;
      border: 1px solid #ccc;
      border-radius: 5px;
      line-height: 1.6;
    }
    .missing-or-wrong {
      background-color: #ffcccc;
      color: red;
      font-weight: bold;
    }
    .extra-word {
      background-color: #fff3cd;
      color: #856404;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Dictation Error Highlighter</h1>

  <h3>Official Passage:</h3>
  <textarea id="originalText" placeholder="Paste the original dictation passage here..."></textarea>

  <h3>Your Typed Passage:</h3>
  <textarea id="userText" placeholder="Type your version here..."></textarea>

  <button class="btn" onclick="highlightErrors()">Evaluate</button>

  <div id="results"></div>

  <script>
    function tokenize(text) {
      return text.match(/\b[\w'â€™-]+\b|[.,!?;:"]+/g) || [];
    }

    function lcs(X, Y) {
      const m = X.length, n = Y.length;
      const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          if (X[i - 1] === Y[j - 1]) {
            dp[i][j] = dp[i - 1][j - 1] + 1;
          } else {
            dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
          }
        }
      }

      let i = m, j = n, pairs = [];
      while (i > 0 && j > 0) {
        if (X[i - 1] === Y[j - 1]) {
          pairs.unshift([i - 1, j - 1]);
          i--; j--;
        } else if (dp[i - 1][j] > dp[i][j - 1]) {
          i--;
        } else {
          j--;
        }
      }
      return pairs;
    }

    function highlightErrors() {
      const original = tokenize(document.getElementById("originalText").value.trim());
      const user = tokenize(document.getElementById("userText").value.trim());

      const matches = lcs(original, user);
      const originalMatched = new Set(matches.map(p => p[0]));
      const userMatched = new Set(matches.map(p => p[1]));

      let missingOrWrong = 0;
      let extra = 0;
      let missingPunctuations = 0;

      let oi = 0, ui = 0, lcsIndex = 0;
      let highlighted = "";

      while (oi < original.length || ui < user.length) {
        if (lcsIndex < matches.length && oi === matches[lcsIndex][0] && ui === matches[lcsIndex][1]) {
          highlighted += `${user[ui]} `;
          oi++;
          ui++;
          lcsIndex++;
        } else if (ui < user.length && !userMatched.has(ui)) {
          highlighted += `<span class='extra-word'>${user[ui]}</span> `;
          extra++;
          ui++;
        } else if (oi < original.length && !originalMatched.has(oi)) {
          highlighted += `<span class='missing-or-wrong'>${original[oi]}</span> `;
          if (/^[.,!?;:"]+$/.test(original[oi])) {
            missingPunctuations++;
          } else {
            missingOrWrong++;
          }
          oi++;
        } else {
          oi++;
          ui++;
        }
      }

      const totalWords = original.filter(w => !/^[.,!?;:"]+$/.test(w)).length;
      const correctWords = totalWords - missingOrWrong;
      const accuracy = Math.max(0, ((correctWords / totalWords) * 100).toFixed(2));

      const resultHTML = `
        <table>
          <tr><th>Total Words</th><td>${totalWords}</td></tr>
          <tr><th>Wrong or Missing Words</th><td>${missingOrWrong}</td></tr>
          <tr><th>Extra Words</th><td>${extra}</td></tr>
          <tr><th>Missing Punctuations</th><td>${missingPunctuations}</td></tr>
          <tr><th>Accuracy (%)</th><td>${accuracy}%</td></tr>
        </table>
        <div class="highlight-box">
          <strong>Highlighted Comparison:</strong><br>${highlighted.trim()}
        </div>
      `;

      document.getElementById("results").innerHTML = resultHTML;
    }
  </script>
</body>
</html>
